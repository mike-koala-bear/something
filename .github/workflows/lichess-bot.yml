name: Continuous Lichess Bot (2AM-10AM)

on:
  workflow_run:
    workflows: ["Continuous Lichess Bot (8PM-2AM)"]
    types:
      - completed

permissions:
  actions: write
  contents: read

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 470 # Safe for 2AM â†’ 10AM
    env:
      LICHESS_TOKEN: ${{ secrets.LICHESS_TOKEN }}
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Copy private config
        uses: actions/checkout@v5
        with:
          repository: mike-koala-bear/tacticalbot-config
          token: ${{ secrets.PRIVATE_CONFIG_TOKEN }}
          path: tacticalbot-config

      - name: Inject Bot Token
        run: |
          cp tacticalbot-config/config.yml ./config.yml
          sed -i "s/tokenXXXXX/${{ secrets.LICHESS_TOKEN }}/g" config.yml

      - name: Start matchmaking
        run: |
          echo "Starting post-2AM matchmaking..."
          python3 -u user_interface.py matchmaking
